import { addContractByABI, getContractByABI, addProcessor, getProcessor, getProvider, transformEtherError, BaseProcessor, BaseProcessorTemplate, BoundContractView, ContractView, DummyProvider, encodeCallData, } from "@sentio/sdk/eth";
import { ERC721__factory } from "./index.js";
const templateContract = ERC721__factory.connect("0x0", DummyProvider);
export class ERC721ContractView extends ContractView {
    constructor(contract) {
        super(contract);
        this.callStatic.contract = contract;
    }
    async totalSupply(overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("totalSupply()")(overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async balanceOf(owner, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("balanceOf(address)")(owner, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async getApproved(tokenId, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("getApproved(uint256)")(tokenId, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async isApprovedForAll(owner, operator, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("isApprovedForAll(address,address)")(owner, operator, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async name(overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("name()")(overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async ownerOf(tokenId, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("ownerOf(uint256)")(tokenId, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async supportsInterface(interfaceId, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("supportsInterface(bytes4)")(interfaceId, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async symbol(overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("symbol()")(overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    async tokenURI(tokenId, overrides, preparedData, ethCallContext) {
        try {
            return await this.contract.getFunction("tokenURI(uint256)")(tokenId, overrides || {});
        }
        catch (e) {
            const stack = new Error().stack;
            throw transformEtherError(e, undefined, stack);
        }
    }
    callStatic = {
        contract: this.contract,
        async approve(to, tokenId, overrides, preparedData, ethCallContext) {
            try {
                return await this.contract
                    .getFunction("approve(address,uint256)")
                    .staticCall(to, tokenId, overrides || {});
            }
            catch (e) {
                const stack = new Error().stack;
                throw transformEtherError(e, undefined, stack);
            }
        },
        async safeTransferFrom_address_address_uint256(from, to, tokenId, overrides, preparedData, ethCallContext) {
            try {
                return await this.contract
                    .getFunction("safeTransferFrom(address,address,uint256)")
                    .staticCall(from, to, tokenId, overrides || {});
            }
            catch (e) {
                const stack = new Error().stack;
                throw transformEtherError(e, undefined, stack);
            }
        },
        async safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, overrides, preparedData, ethCallContext) {
            try {
                return await this.contract
                    .getFunction("safeTransferFrom(address,address,uint256,bytes)")
                    .staticCall(from, to, tokenId, data, overrides || {});
            }
            catch (e) {
                const stack = new Error().stack;
                throw transformEtherError(e, undefined, stack);
            }
        },
        async setApprovalForAll(operator, _approved, overrides, preparedData, ethCallContext) {
            try {
                return await this.contract
                    .getFunction("setApprovalForAll(address,bool)")
                    .staticCall(operator, _approved, overrides || {});
            }
            catch (e) {
                const stack = new Error().stack;
                throw transformEtherError(e, undefined, stack);
            }
        },
        async transferFrom(from, to, tokenId, overrides, preparedData, ethCallContext) {
            try {
                return await this.contract
                    .getFunction("transferFrom(address,address,uint256)")
                    .staticCall(from, to, tokenId, overrides || {});
            }
            catch (e) {
                const stack = new Error().stack;
                throw transformEtherError(e, undefined, stack);
            }
        },
    };
    encodeCall = {
        approve(to, tokenId, callContext) {
            return encodeCallData(callContext, "approve", "function approve(address,uint256)", [to, tokenId]);
        },
        totalSupply(callContext) {
            return encodeCallData(callContext, "totalSupply", "function totalSupply()", []);
        },
        balanceOf(owner, callContext) {
            return encodeCallData(callContext, "balanceOf", "function balanceOf(address)", [owner]);
        },
        getApproved(tokenId, callContext) {
            return encodeCallData(callContext, "getApproved", "function getApproved(uint256)", [tokenId]);
        },
        isApprovedForAll(owner, operator, callContext) {
            return encodeCallData(callContext, "isApprovedForAll", "function isApprovedForAll(address,address)", [owner, operator]);
        },
        name(callContext) {
            return encodeCallData(callContext, "name", "function name()", []);
        },
        ownerOf(tokenId, callContext) {
            return encodeCallData(callContext, "ownerOf", "function ownerOf(uint256)", [tokenId]);
        },
        safeTransferFrom_address_address_uint256(from, to, tokenId, callContext) {
            return encodeCallData(callContext, "safeTransferFrom", "function safeTransferFrom(address,address,uint256)", [from, to, tokenId]);
        },
        safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, callContext) {
            return encodeCallData(callContext, "safeTransferFrom", "function safeTransferFrom(address,address,uint256,bytes)", [from, to, tokenId, data]);
        },
        setApprovalForAll(operator, _approved, callContext) {
            return encodeCallData(callContext, "setApprovalForAll", "function setApprovalForAll(address,bool)", [operator, _approved]);
        },
        supportsInterface(interfaceId, callContext) {
            return encodeCallData(callContext, "supportsInterface", "function supportsInterface(bytes4)", [interfaceId]);
        },
        symbol(callContext) {
            return encodeCallData(callContext, "symbol", "function symbol()", []);
        },
        tokenURI(tokenId, callContext) {
            return encodeCallData(callContext, "tokenURI", "function tokenURI(uint256)", [tokenId]);
        },
        transferFrom(from, to, tokenId, callContext) {
            return encodeCallData(callContext, "transferFrom", "function transferFrom(address,address,uint256)", [from, to, tokenId]);
        },
    };
}
export class ERC721BoundContractView extends BoundContractView {
    async totalSupply(overrides) {
        return await this.view.totalSupply({
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async balanceOf(owner, overrides) {
        return await this.view.balanceOf(owner, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async getApproved(tokenId, overrides) {
        return await this.view.getApproved(tokenId, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async isApprovedForAll(owner, operator, overrides) {
        return await this.view.isApprovedForAll(owner, operator, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async name(overrides) {
        return await this.view.name({
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async ownerOf(tokenId, overrides) {
        return await this.view.ownerOf(tokenId, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async supportsInterface(interfaceId, overrides) {
        return await this.view.supportsInterface(interfaceId, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async symbol(overrides) {
        return await this.view.symbol({
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    async tokenURI(tokenId, overrides) {
        return await this.view.tokenURI(tokenId, {
            blockTag: this.context.blockNumber,
            ...overrides,
        }, this.context.preparedData, this.context.getEthCallContext());
    }
    callStatic = {
        view: this.view,
        context: this.context,
        async approve(to, tokenId, overrides) {
            return await this.view.callStatic.approve(to, tokenId, {
                blockTag: this.context.blockNumber,
                ...overrides,
            }, this.context.preparedData, this.context.getEthCallContext());
        },
        async safeTransferFrom_address_address_uint256(from, to, tokenId, overrides) {
            return await this.view.callStatic.safeTransferFrom_address_address_uint256(from, to, tokenId, {
                blockTag: this.context.blockNumber,
                ...overrides,
            }, this.context.preparedData, this.context.getEthCallContext());
        },
        async safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, overrides) {
            return await this.view.callStatic.safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, {
                blockTag: this.context.blockNumber,
                ...overrides,
            }, this.context.preparedData, this.context.getEthCallContext());
        },
        async setApprovalForAll(operator, _approved, overrides) {
            return await this.view.callStatic.setApprovalForAll(operator, _approved, {
                blockTag: this.context.blockNumber,
                ...overrides,
            }, this.context.preparedData, this.context.getEthCallContext());
        },
        async transferFrom(from, to, tokenId, overrides) {
            return await this.view.callStatic.transferFrom(from, to, tokenId, {
                blockTag: this.context.blockNumber,
                ...overrides,
            }, this.context.preparedData, this.context.getEthCallContext());
        },
    };
    encodeCall = {
        view: this.view,
        context: this.context,
        approve(to, tokenId, overrides) {
            return this.view.encodeCall.approve(to, tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        totalSupply(overrides) {
            return this.view.encodeCall.totalSupply({
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        balanceOf(owner, overrides) {
            return this.view.encodeCall.balanceOf(owner, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        getApproved(tokenId, overrides) {
            return this.view.encodeCall.getApproved(tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        isApprovedForAll(owner, operator, overrides) {
            return this.view.encodeCall.isApprovedForAll(owner, operator, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        name(overrides) {
            return this.view.encodeCall.name({
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        ownerOf(tokenId, overrides) {
            return this.view.encodeCall.ownerOf(tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        safeTransferFrom_address_address_uint256(from, to, tokenId, overrides) {
            return this.view.encodeCall.safeTransferFrom_address_address_uint256(from, to, tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, overrides) {
            return this.view.encodeCall.safeTransferFrom_address_address_uint256_bytes(from, to, tokenId, data, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        setApprovalForAll(operator, _approved, overrides) {
            return this.view.encodeCall.setApprovalForAll(operator, _approved, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        supportsInterface(interfaceId, overrides) {
            return this.view.encodeCall.supportsInterface(interfaceId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        symbol(overrides) {
            return this.view.encodeCall.symbol({
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        tokenURI(tokenId, overrides) {
            return this.view.encodeCall.tokenURI(tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
        transferFrom(from, to, tokenId, overrides) {
            return this.view.encodeCall.transferFrom(from, to, tokenId, {
                chainId: this.context.chainId.toString(),
                address: this.context.address,
                blockTag: this.context.getBlockTag(overrides),
            });
        },
    };
}
export class ERC721Processor extends BaseProcessor {
    onEventApproval(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["Approval(address,address,uint256)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
    onEventApprovalForAll(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["ApprovalForAll(address,address,bool)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
    onEventTransfer(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["Transfer(address,address,uint256)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
    onCallApprove(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x095ea7b3", handler, handlerOptions, preprocessHandler);
    }
    onCallTotalSupply(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x18160ddd", handler, handlerOptions, preprocessHandler);
    }
    onCallBalanceOf(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x70a08231", handler, handlerOptions, preprocessHandler);
    }
    onCallGetApproved(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x081812fc", handler, handlerOptions, preprocessHandler);
    }
    onCallIsApprovedForAll(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0xe985e9c5", handler, handlerOptions, preprocessHandler);
    }
    onCallName(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x06fdde03", handler, handlerOptions, preprocessHandler);
    }
    onCallOwnerOf(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x6352211e", handler, handlerOptions, preprocessHandler);
    }
    onCallSafeTransferFrom_address_address_uint256(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x42842e0e", handler, handlerOptions, preprocessHandler);
    }
    onCallSafeTransferFrom_address_address_uint256_bytes(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0xb88d4fde", handler, handlerOptions, preprocessHandler);
    }
    onCallSetApprovalForAll(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0xa22cb465", handler, handlerOptions, preprocessHandler);
    }
    onCallSupportsInterface(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x01ffc9a7", handler, handlerOptions, preprocessHandler);
    }
    onCallSymbol(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x95d89b41", handler, handlerOptions, preprocessHandler);
    }
    onCallTokenURI(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0xc87b56dd", handler, handlerOptions, preprocessHandler);
    }
    onCallTransferFrom(handler, handlerOptions, preprocessHandler) {
        return super.onEthTrace("0x23b872dd", handler, handlerOptions, preprocessHandler);
    }
    static filters = {
        Approval(owner, approved, tokenId) {
            return templateContract.filters["Approval(address,address,uint256)"](owner, approved, tokenId);
        },
        ApprovalForAll(owner, operator, approved) {
            return templateContract.filters["ApprovalForAll(address,address,bool)"](owner, operator, approved);
        },
        Transfer(from, to, tokenId) {
            return templateContract.filters["Transfer(address,address,uint256)"](from, to, tokenId);
        },
    };
    CreateBoundContractView() {
        const view = getERC721Contract(this.config.network, this.config.address);
        return new ERC721BoundContractView(this.config.address, view);
    }
    static bind(options) {
        if (!options.name) {
            options.name = "ERC721";
        }
        let processor = getProcessor(options);
        if (!processor) {
            processor = new ERC721Processor(options);
            addProcessor(options, processor);
        }
        return processor;
    }
}
export class ERC721ProcessorTemplate extends BaseProcessorTemplate {
    bindInternal(options) {
        if (!options.name) {
            options.name = "ERC721";
        }
        let processor = getProcessor(options);
        if (!processor) {
            processor = new ERC721Processor(options);
            addProcessor(options, processor);
        }
        return processor;
    }
    onEventApproval(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["Approval(address,address,uint256)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
    onEventApprovalForAll(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["ApprovalForAll(address,address,bool)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
    onEventTransfer(handler, filter, handlerOptions, preprocessHandler) {
        if (!filter) {
            filter = templateContract.filters["Transfer(address,address,uint256)"](null, null, null);
        }
        return super.onEthEvent(handler, filter, handlerOptions, preprocessHandler);
    }
}
export function getERC721Contract(chainId, address) {
    let contract = getContractByABI("ERC721", address, chainId);
    if (!contract) {
        const rawContract = ERC721__factory.connect(address, getProvider(chainId));
        contract = new ERC721ContractView(rawContract);
        addContractByABI("ERC721", address, chainId, contract);
    }
    return contract;
}
export function getERC721ContractOnContext(context, address) {
    const view = getERC721Contract(context.getChainId(), address);
    const boundView = new ERC721BoundContractView(address, view);
    boundView.context = context;
    if (boundView.callStatic) {
        boundView.callStatic.context = context;
    }
    return boundView;
}
//# sourceMappingURL=erc721-processor.js.map