import { BaseContract, DeferredTopicFilter, LogParams, TransactionResponseParams } from 'ethers';
import { BoundContractView, ContractContext, ContractView, GlobalContext } from './context.js';
import { AddressType, Data_EthBlock, Data_EthLog, Data_EthTrace, Data_EthTransaction, EthFetchConfig, HandleInterval, PreprocessResult, ProcessResult } from '@sentio/protos';
import { BindOptions, TimeOrBlock } from './bind-options.js';
import { PromiseOrVoid } from '../core/promises.js';
import { RawEvent, RichBlock, Trace, TypedCallTrace, TypedEvent } from './eth.js';
import { ListStateStorage } from '@sentio/runtime';
import { EthChainId } from '@sentio/chain';
import { HandlerOptions } from '../core/index.js';
export interface AddressOrTypeEventFilter extends DeferredTopicFilter {
    addressType?: AddressType;
    address?: string;
}
export declare const defaultPreprocessHandler: () => any;
export declare class EventsHandler {
    filters: AddressOrTypeEventFilter[];
    handlerName: string;
    handler: (event: Data_EthLog) => Promise<ProcessResult>;
    preprocessHandler?: (event: Data_EthLog, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>;
    fetchConfig: EthFetchConfig;
    partitionHandler?: (event: Data_EthLog) => Promise<string | undefined>;
}
export declare class TraceHandler {
    signatures: string[];
    handlerName: string;
    handler: (trace: Data_EthTrace) => Promise<ProcessResult>;
    preprocessHandler?: (event: Data_EthTrace, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>;
    fetchConfig: EthFetchConfig;
    partitionHandler?: (trace: Data_EthTrace) => Promise<string | undefined>;
}
export declare class BlockHandler {
    blockInterval?: HandleInterval;
    timeIntervalInMinutes?: HandleInterval;
    handlerName: string;
    handler: (block: Data_EthBlock) => Promise<ProcessResult>;
    preprocessHandler?: (event: Data_EthBlock, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>;
    fetchConfig: EthFetchConfig;
    partitionHandler?: (block: Data_EthBlock) => Promise<string | undefined>;
}
export declare class TransactionHandler {
    handler: (tx: Data_EthTransaction) => Promise<ProcessResult>;
    handlerName: string;
    preprocessHandler?: (event: Data_EthTransaction, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>;
    fetchConfig: EthFetchConfig;
    partitionHandler?: (tx: Data_EthTransaction) => Promise<string | undefined>;
}
declare class BindInternalOptions {
    address: string;
    network: EthChainId;
    name: string;
    start: TimeOrBlock;
    end?: TimeOrBlock;
    baseLabels?: {
        [key: string]: string;
    };
}
export declare class GlobalProcessorState extends ListStateStorage<GlobalProcessor> {
    static INSTANCE: GlobalProcessorState;
}
export declare class GlobalProcessor {
    config: BindInternalOptions;
    blockHandlers: BlockHandler[];
    transactionHandler: TransactionHandler[];
    traceHandlers: TraceHandler[];
    eventHandlers: EventsHandler[];
    static bind(config: Omit<BindOptions, 'address'>): GlobalProcessor;
    constructor(config: Omit<BindOptions, 'address'>);
    onBlockInterval(handler: (block: RichBlock, ctx: GlobalContext) => PromiseOrVoid, blockInterval?: number, backfillBlockInterval?: number, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: GlobalContext, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    onTimeInterval(handler: (block: RichBlock, ctx: GlobalContext) => PromiseOrVoid, timeIntervalInMinutes?: number, backfillTimeIntervalInMinutes?: number, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: GlobalContext, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    getChainId(): EthChainId;
    onInterval(handler: (block: RichBlock, ctx: GlobalContext) => PromiseOrVoid, timeInterval: HandleInterval | undefined, blockInterval: HandleInterval | undefined, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: GlobalContext, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    onTransaction(handler: (transaction: TransactionResponseParams, ctx: GlobalContext) => PromiseOrVoid, handlerOptions?: HandlerOptions<EthFetchConfig, TransactionResponseParams>, preprocessHandler?: (transaction: TransactionResponseParams, ctx: GlobalContext, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    onEvent(handler: (rawLog: LogParams, ctx: GlobalContext) => PromiseOrVoid, filter?: AddressOrTypeEventFilter | AddressOrTypeEventFilter[], handlerOptions?: HandlerOptions<EthFetchConfig, TypedEvent>): this;
    onTrace(signatures: string | string[], handler: (trace: Trace, ctx: GlobalContext) => PromiseOrVoid, handlerOptions?: HandlerOptions<EthFetchConfig, Trace>, preprocessHandler?: (trace: Trace, ctx: GlobalContext, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
}
export declare abstract class BaseProcessor<TContract extends BaseContract, TBoundContractView extends BoundContractView<TContract, ContractView<TContract>>> {
    blockHandlers: BlockHandler[];
    eventHandlers: EventsHandler[];
    traceHandlers: TraceHandler[];
    config: BindInternalOptions;
    constructor(config: BindOptions);
    protected abstract CreateBoundContractView(): TBoundContractView;
    getChainId(): EthChainId;
    onEvent(handler: (event: TypedEvent, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, handlerOptions?: HandlerOptions<EthFetchConfig, TypedEvent>, preprocessHandler?: (event: TypedEvent, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    protected onEthEvent(handler: (event: TypedEvent | RawEvent, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, filter: DeferredTopicFilter | DeferredTopicFilter[], handlerOptions?: HandlerOptions<EthFetchConfig, TypedEvent>, preprocessHandler?: (event: TypedEvent, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>, handlerName?: string): this;
    onBlockInterval(handler: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, blockInterval?: number, backfillBlockInterval?: number, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    onTimeInterval(handler: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, timeIntervalInMinutes?: number, backfillTimeIntervalInMinutes?: number, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
    onInterval(handler: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, timeInterval: HandleInterval | undefined, blockInterval: HandleInterval | undefined, handlerOptions?: HandlerOptions<EthFetchConfig, RichBlock>, preprocessHandler?: (block: RichBlock, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>, handlerName?: string): this;
    protected onEthTrace(signatures: string | string[], handler: (trace: TypedCallTrace, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, handlerOptions?: HandlerOptions<EthFetchConfig, TypedCallTrace>, preprocessHandler?: (trace: TypedCallTrace, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>, handlerName?: string): this;
    onTrace(handler: (event: TypedCallTrace, ctx: ContractContext<TContract, TBoundContractView>) => PromiseOrVoid, handlerOptions?: HandlerOptions<EthFetchConfig, TypedCallTrace>, preprocessHandler?: (trace: TypedCallTrace, ctx: ContractContext<TContract, TBoundContractView>, preprocessStore: {
        [k: string]: any;
    }) => Promise<PreprocessResult>): this;
}
export {};
//# sourceMappingURL=base-processor.d.ts.map