{"version":3,"sources":["../src/test-processor.test.ts"],"sourcesContent":["import { Plugin, PluginManager } from './plugin.js'\nimport { DataBinding, HandlerType, ProcessResult } from './gen/processor/protos/processor.js'\nimport { AccountConfig, InitResponse, ProcessConfigResponse, ProcessStreamResponse_Partitions } from '@sentio/protos'\n\nexport class TestPlugin extends Plugin {\n  async processBinding(request: DataBinding): Promise<ProcessResult> {\n    const dbContext = PluginManager.INSTANCE.dbContextLocalStorage.getStore()\n    if (dbContext) {\n      await dbContext.sendRequest({\n        get: {\n          entity: 'Test',\n          id: '1'\n        }\n      })\n    }\n\n    return ProcessResult.fromPartial({\n      states: {\n        configUpdated: true\n      }\n    })\n  }\n  supportedHandlers = [HandlerType.UNKNOWN, HandlerType.ETH_LOG]\n\n  async partition(request: DataBinding): Promise<ProcessStreamResponse_Partitions> {\n    return {\n      partitions: request.handlerIds.reduce(\n        (acc, id) => ({\n          ...acc,\n          [id]: {\n            userValue: 'test'\n          }\n        }),\n        {}\n      )\n    }\n  }\n\n  async init(config: InitResponse): Promise<void> {\n    config.chainIds = ['1']\n  }\n\n  async configure(config: ProcessConfigResponse, forChainId?: string): Promise<void> {\n    config.accountConfigs = [\n      AccountConfig.fromPartial({\n        address: '0x',\n        chainId: '1'\n      })\n    ]\n  }\n}\n\nPluginManager.INSTANCE.plugins = []\nPluginManager.INSTANCE.register(new TestPlugin())\n;import(\"node:process\").then((p) => p.stdout.write(\"\"));"],"mappings":";oFAIO,IAAMA,EAAN,cAAyBC,CAAO,CACrC,MAAM,eAAeC,EAA8C,CACjE,IAAMC,EAAYC,EAAc,SAAS,sBAAsB,SAAS,EACxE,OAAID,GACF,MAAMA,EAAU,YAAY,CAC1B,IAAK,CACH,OAAQ,OACR,GAAI,GACN,CACF,CAAC,EAGIE,EAAc,YAAY,CAC/B,OAAQ,CACN,cAAe,EACjB,CACF,CAAC,CACH,CACA,kBAAoB,IAAyC,EAE7D,MAAM,UAAUH,EAAiE,CAC/E,MAAO,CACL,WAAYA,EAAQ,WAAW,OAC7B,CAACI,EAAKC,KAAQ,CACZ,GAAGD,EACH,CAACC,CAAE,EAAG,CACJ,UAAW,MACb,CACF,GACA,CAAC,CACH,CACF,CACF,CAEA,MAAM,KAAKC,EAAqC,CAC9CA,EAAO,SAAW,CAAC,GAAG,CACxB,CAEA,MAAM,UAAUA,EAA+BC,EAAoC,CACjFD,EAAO,eAAiB,CACtBE,EAAc,YAAY,CACxB,QAAS,KACT,QAAS,GACX,CAAC,CACH,CACF,CACF,EAEAN,EAAc,SAAS,QAAU,CAAC,EAClCA,EAAc,SAAS,SAAS,IAAIJ,CAAY,EAC/C,OAAO,cAAc,EAAE,KAAMW,GAAMA,EAAE,OAAO,MAAM,EAAE,CAAC","names":["TestPlugin","Plugin","request","dbContext","PluginManager","ProcessResult","acc","id","config","forChainId","AccountConfig","p"]}