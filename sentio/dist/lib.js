import { createRequire } from 'module'; const require = createRequire(import.meta.url);
var l=Object.defineProperty;var o=(e,t)=>l(e,"name",{value:t,configurable:!0});import{AptosModulesProcessor as _,AptosNetwork as g}from"@sentio/sdk/aptos";var p="0x3f7399a0d3d646ce94ee0badf16c4c3f3c656fe3a5e142e83b5ebc011aa8b3d",v="0x83121c9f9b0527d1f056e21a950d6bf3b9e9e2e8353d0e95ccea726713cbea39";var b={MOVE:8,USDC:6},f=["0x682330a16592406f9f4fd5b4822cbe01af2f227825b9711d166fcea5e0ca4838","0x28b57594e3c48fd4303887482a0667127fc761a20f5c3bd9401c5841904e322a"];function m(e,t){return(typeof e=="bigint"?Number(e):typeof e=="string"?parseInt(e,10):e)/Math.pow(10,t)}o(m,"fromRawAmount");function C(e){return f.length===0?!0:f.some(t=>t.toLowerCase()===e.toLowerCase())}o(C,"isBuybackWallet");function w(e){return e.toLowerCase()===v.toLowerCase()}o(w,"isUsdcAsset");function A(e){return e.toLowerCase().includes("aptos_coin")}o(A,"isMoveAsset");_.bind({address:p,network:g.MOVEMENT_MAIN_NET,startVersion:0n}).onTransaction(async(e,t)=>{if(e.success&&e.events)for(let i of e.events){if(!i.type.includes(`${p}::router::SwapEvent`))continue;let s=i.data,n=s.sender;if(!C(n))continue;let c=s.input_asset,u=s.output_asset;if(!(w(c)&&A(u)))continue;let a=m(s.input_amount,b.USDC),r=m(s.output_amount,b.MOVE),d=a>0&&r>0?a/r:0;t.eventLogger.emit("buyback",{distinctId:e.hash,txHash:e.hash,wallet:n,timestamp:Number(s.timestamp),usdcAmount:a,moveAmount:r,pricePerMove:d,inputAsset:c,outputAsset:u,version:e.version?.toString()||"0",success:e.success}),t.meter.Counter("buyback_count").add(1,{wallet:n}),t.meter.Counter("buyback_usdc_total").add(a,{wallet:n}),t.meter.Counter("buyback_move_total").add(r,{wallet:n}),t.meter.Gauge("buyback_price").record(d,{wallet:n})}},{includeFailed:!1});import("node:process").then(e=>e.stdout.write(""));
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL3Byb2Nlc3Nvci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXB0b3NNb2R1bGVzUHJvY2Vzc29yLCBBcHRvc0NvbnRleHQsIEFwdG9zTmV0d29yayB9IGZyb20gXCJAc2VudGlvL3Nkay9hcHRvc1wiXG5pbXBvcnQgdHlwZSB7IFVzZXJUcmFuc2FjdGlvblJlc3BvbnNlIH0gZnJvbSBcIkBhcHRvcy1sYWJzL3RzLXNka1wiO1xuXG4vLyBNb3NhaWMgUm91dGVyIGNvbnRyYWN0IGFkZHJlc3Mgb24gTW92ZW1lbnQgbWFpbm5ldFxuY29uc3QgTU9TQUlDX1JPVVRFUiA9IFwiMHgzZjczOTlhMGQzZDY0NmNlOTRlZTBiYWRmMTZjNGMzZjNjNjU2ZmUzYTVlMTQyZTgzYjVlYmMwMTFhYThiM2RcIjtcblxuLy8gVG9rZW4gYWRkcmVzc2VzXG5jb25zdCBVU0RDX0FERFJFU1MgPSBcIjB4ODMxMjFjOWY5YjA1MjdkMWYwNTZlMjFhOTUwZDZiZjNiOWU5ZTJlODM1M2QwZTk1Y2NlYTcyNjcxM2NiZWEzOVwiO1xuY29uc3QgTU9WRV9BRERSRVNTID0gXCIweDE6OmFwdG9zX2NvaW46OkFwdG9zQ29pblwiO1xuXG4vLyBUb2tlbiBkZWNpbWFsc1xuY29uc3QgVE9LRU5fREVDSU1BTFMgPSB7XG4gIE1PVkU6IDgsXG4gIFVTREM6IDYsXG59IGFzIGNvbnN0O1xuXG4vLyBCdXliYWNrIHdhbGxldCBhZGRyZXNzZXMgdG8gdHJhY2tcbmNvbnN0IEJVWUJBQ0tfV0FMTEVUUzogc3RyaW5nW10gPSBbXG4gIC8vIE1hbnVhbCBidXliYWNrIHdhbGxldFxuICBcIjB4NjgyMzMwYTE2NTkyNDA2ZjlmNGZkNWI0ODIyY2JlMDFhZjJmMjI3ODI1Yjk3MTFkMTY2ZmNlYTVlMGNhNDgzOFwiLFxuICAvLyBUV0FQIEJvdCBleGVjdXRvciB3YWxsZXRcbiAgXCIweDI4YjU3NTk0ZTNjNDhmZDQzMDM4ODc0ODJhMDY2NzEyN2ZjNzYxYTIwZjVjM2JkOTQwMWM1ODQxOTA0ZTMyMmFcIixcbl07XG5cbi8qKlxuICogQ29udmVydCByYXcgYW1vdW50IHRvIGh1bWFuLXJlYWRhYmxlIGFtb3VudFxuICovXG5mdW5jdGlvbiBmcm9tUmF3QW1vdW50KHJhd0Ftb3VudDogYmlnaW50IHwgbnVtYmVyIHwgc3RyaW5nLCBkZWNpbWFsczogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3QgcmF3ID0gdHlwZW9mIHJhd0Ftb3VudCA9PT0gXCJiaWdpbnRcIiA/IE51bWJlcihyYXdBbW91bnQpIDogXG4gICAgICAgICAgICAgIHR5cGVvZiByYXdBbW91bnQgPT09IFwic3RyaW5nXCIgPyBwYXJzZUludChyYXdBbW91bnQsIDEwKSA6IHJhd0Ftb3VudDtcbiAgcmV0dXJuIHJhdyAvIE1hdGgucG93KDEwLCBkZWNpbWFscyk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWRkcmVzcyBpcyBhIHRyYWNrZWQgYnV5YmFjayB3YWxsZXRcbiAqL1xuZnVuY3Rpb24gaXNCdXliYWNrV2FsbGV0KGFkZHJlc3M6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBpZiAoQlVZQkFDS19XQUxMRVRTLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBCVVlCQUNLX1dBTExFVFMuc29tZShcbiAgICAod2FsbGV0KSA9PiB3YWxsZXQudG9Mb3dlckNhc2UoKSA9PT0gYWRkcmVzcy50b0xvd2VyQ2FzZSgpXG4gICk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYXNzZXQgaXMgVVNEQ1xuICovXG5mdW5jdGlvbiBpc1VzZGNBc3NldChhc3NldDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBhc3NldC50b0xvd2VyQ2FzZSgpID09PSBVU0RDX0FERFJFU1MudG9Mb3dlckNhc2UoKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhc3NldCBpcyBNT1ZFXG4gKi9cbmZ1bmN0aW9uIGlzTW92ZUFzc2V0KGFzc2V0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIGFzc2V0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJhcHRvc19jb2luXCIpO1xufVxuXG4vLyBEZWZpbmUgdGhlIFN3YXBFdmVudCBkYXRhIHN0cnVjdHVyZVxuaW50ZXJmYWNlIFN3YXBFdmVudERhdGEge1xuICBzZW5kZXI6IHN0cmluZztcbiAgcmVjZWl2ZXI6IHN0cmluZztcbiAgaW5wdXRfYXNzZXQ6IHN0cmluZztcbiAgb3V0cHV0X2Fzc2V0OiBzdHJpbmc7XG4gIGlucHV0X2Ftb3VudDogc3RyaW5nO1xuICBvdXRwdXRfYW1vdW50OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBleHRyYV9kYXRhPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb2Nlc3MgTW9zYWljIHJvdXRlciBzd2FwIGV2ZW50c1xuICovXG5BcHRvc01vZHVsZXNQcm9jZXNzb3IuYmluZCh7XG4gIGFkZHJlc3M6IE1PU0FJQ19ST1VURVIsXG4gIG5ldHdvcms6IEFwdG9zTmV0d29yay5NT1ZFTUVOVF9NQUlOX05FVCxcbiAgc3RhcnRWZXJzaW9uOiAwbixcbn0pLm9uVHJhbnNhY3Rpb24oXG4gIGFzeW5jICh0eDogVXNlclRyYW5zYWN0aW9uUmVzcG9uc2UsIGN0eDogQXB0b3NDb250ZXh0KSA9PiB7XG4gICAgLy8gU2tpcCBmYWlsZWQgdHJhbnNhY3Rpb25zXG4gICAgaWYgKCF0eC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gTG9vayBmb3IgU3dhcEV2ZW50IGZyb20gTW9zYWljIHJvdXRlclxuICAgIGlmICghdHguZXZlbnRzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBldmVudCBvZiB0eC5ldmVudHMpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBNb3NhaWMgU3dhcEV2ZW50XG4gICAgICBpZiAoIWV2ZW50LnR5cGUuaW5jbHVkZXMoYCR7TU9TQUlDX1JPVVRFUn06OnJvdXRlcjo6U3dhcEV2ZW50YCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV2ZW50LmRhdGEgYXMgU3dhcEV2ZW50RGF0YTtcbiAgICAgIGNvbnN0IHNlbmRlciA9IGV2ZW50RGF0YS5zZW5kZXI7XG5cbiAgICAgIC8vIE9ubHkgcHJvY2VzcyB0cmFuc2FjdGlvbnMgZnJvbSB0cmFja2VkIGJ1eWJhY2sgd2FsbGV0c1xuICAgICAgaWYgKCFpc0J1eWJhY2tXYWxsZXQoc2VuZGVyKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIFVTREMgLT4gTU9WRSBzd2FwIChidXliYWNrKVxuICAgICAgY29uc3QgaW5wdXRBc3NldCA9IGV2ZW50RGF0YS5pbnB1dF9hc3NldDtcbiAgICAgIGNvbnN0IG91dHB1dEFzc2V0ID0gZXZlbnREYXRhLm91dHB1dF9hc3NldDtcblxuICAgICAgY29uc3QgaXNVc2RjVG9Nb3ZlID0gaXNVc2RjQXNzZXQoaW5wdXRBc3NldCkgJiYgaXNNb3ZlQXNzZXQob3V0cHV0QXNzZXQpO1xuXG4gICAgICBpZiAoIWlzVXNkY1RvTW92ZSkge1xuICAgICAgICAvLyBTa2lwIG5vbi1idXliYWNrIHN3YXBzIChlLmcuLCBNT1ZFIC0+IFVTREMgd291bGQgYmUgYSBzZWxsKVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gUGFyc2UgYW1vdW50c1xuICAgICAgY29uc3QgdXNkY0Ftb3VudCA9IGZyb21SYXdBbW91bnQoZXZlbnREYXRhLmlucHV0X2Ftb3VudCwgVE9LRU5fREVDSU1BTFMuVVNEQyk7XG4gICAgICBjb25zdCBtb3ZlQW1vdW50ID0gZnJvbVJhd0Ftb3VudChldmVudERhdGEub3V0cHV0X2Ftb3VudCwgVE9LRU5fREVDSU1BTFMuTU9WRSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBlZmZlY3RpdmUgcHJpY2VcbiAgICAgIGNvbnN0IHByaWNlUGVyTW92ZSA9IHVzZGNBbW91bnQgPiAwICYmIG1vdmVBbW91bnQgPiAwIFxuICAgICAgICA/IHVzZGNBbW91bnQgLyBtb3ZlQW1vdW50IFxuICAgICAgICA6IDA7XG5cbiAgICAgIC8vIExvZyB0aGUgYnV5YmFjayBldmVudFxuICAgICAgY3R4LmV2ZW50TG9nZ2VyLmVtaXQoXCJidXliYWNrXCIsIHtcbiAgICAgICAgZGlzdGluY3RJZDogdHguaGFzaCxcbiAgICAgICAgdHhIYXNoOiB0eC5oYXNoLFxuICAgICAgICB3YWxsZXQ6IHNlbmRlcixcbiAgICAgICAgdGltZXN0YW1wOiBOdW1iZXIoZXZlbnREYXRhLnRpbWVzdGFtcCksXG4gICAgICAgIHVzZGNBbW91bnQsXG4gICAgICAgIG1vdmVBbW91bnQsXG4gICAgICAgIHByaWNlUGVyTW92ZSxcbiAgICAgICAgaW5wdXRBc3NldCxcbiAgICAgICAgb3V0cHV0QXNzZXQsXG4gICAgICAgIHZlcnNpb246IHR4LnZlcnNpb24/LnRvU3RyaW5nKCkgfHwgXCIwXCIsXG4gICAgICAgIHN1Y2Nlc3M6IHR4LnN1Y2Nlc3MsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW1pdCBtZXRyaWNzIGZvciBkYXNoYm9hcmRzXG4gICAgICBjdHgubWV0ZXIuQ291bnRlcihcImJ1eWJhY2tfY291bnRcIikuYWRkKDEsIHsgd2FsbGV0OiBzZW5kZXIgfSk7XG4gICAgICBjdHgubWV0ZXIuQ291bnRlcihcImJ1eWJhY2tfdXNkY190b3RhbFwiKS5hZGQodXNkY0Ftb3VudCwgeyB3YWxsZXQ6IHNlbmRlciB9KTtcbiAgICAgIGN0eC5tZXRlci5Db3VudGVyKFwiYnV5YmFja19tb3ZlX3RvdGFsXCIpLmFkZChtb3ZlQW1vdW50LCB7IHdhbGxldDogc2VuZGVyIH0pO1xuICAgICAgY3R4Lm1ldGVyLkdhdWdlKFwiYnV5YmFja19wcmljZVwiKS5yZWNvcmQocHJpY2VQZXJNb3ZlLCB7IHdhbGxldDogc2VuZGVyIH0pO1xuICAgIH1cbiAgfSxcbiAgeyBpbmNsdWRlRmFpbGVkOiBmYWxzZSB9XG4pO1xuO2ltcG9ydChcIm5vZGU6cHJvY2Vzc1wiKS50aGVuKChwKSA9PiBwLnN0ZG91dC53cml0ZShcIlwiKSk7Il0sCiAgIm1hcHBpbmdzIjogIjsrRUFBQSxPQUFTLHlCQUFBQSxFQUFxQyxnQkFBQUMsTUFBb0Isb0JBSWxFLElBQU1DLEVBQWdCLG9FQUdoQkMsRUFBZSxxRUFJckIsSUFBTUMsRUFBaUIsQ0FDckIsS0FBTSxFQUNOLEtBQU0sQ0FDUixFQUdNQyxFQUE0QixDQUVoQyxxRUFFQSxvRUFDRixFQUtBLFNBQVNDLEVBQWNDLEVBQXFDQyxFQUEwQixDQUdwRixPQUZZLE9BQU9ELEdBQWMsU0FBVyxPQUFPQSxDQUFTLEVBQ2hELE9BQU9BLEdBQWMsU0FBVyxTQUFTQSxFQUFXLEVBQUUsRUFBSUEsR0FDekQsS0FBSyxJQUFJLEdBQUlDLENBQVEsQ0FDcEMsQ0FKU0MsRUFBQUgsRUFBQSxpQkFTVCxTQUFTSSxFQUFnQkMsRUFBMEIsQ0FDakQsT0FBSU4sRUFBZ0IsU0FBVyxFQUN0QixHQUVGQSxFQUFnQixLQUNwQk8sR0FBV0EsRUFBTyxZQUFZLElBQU1ELEVBQVEsWUFBWSxDQUMzRCxDQUNGLENBUFNGLEVBQUFDLEVBQUEsbUJBWVQsU0FBU0csRUFBWUMsRUFBd0IsQ0FDM0MsT0FBT0EsRUFBTSxZQUFZLElBQU1DLEVBQWEsWUFBWSxDQUMxRCxDQUZTTixFQUFBSSxFQUFBLGVBT1QsU0FBU0csRUFBWUYsRUFBd0IsQ0FDM0MsT0FBT0EsRUFBTSxZQUFZLEVBQUUsU0FBUyxZQUFZLENBQ2xELENBRlNMLEVBQUFPLEVBQUEsZUFtQlRDLEVBQXNCLEtBQUssQ0FDekIsUUFBU0MsRUFDVCxRQUFTQyxFQUFhLGtCQUN0QixhQUFjLEVBQ2hCLENBQUMsRUFBRSxjQUNELE1BQU9DLEVBQTZCQyxJQUFzQixDQUV4RCxHQUFLRCxFQUFHLFNBS0hBLEVBQUcsT0FJUixRQUFXRSxLQUFTRixFQUFHLE9BQVEsQ0FFN0IsR0FBSSxDQUFDRSxFQUFNLEtBQUssU0FBUyxHQUFHSixDQUFhLHFCQUFxQixFQUM1RCxTQUdGLElBQU1LLEVBQVlELEVBQU0sS0FDbEJFLEVBQVNELEVBQVUsT0FHekIsR0FBSSxDQUFDYixFQUFnQmMsQ0FBTSxFQUN6QixTQUlGLElBQU1DLEVBQWFGLEVBQVUsWUFDdkJHLEVBQWNILEVBQVUsYUFJOUIsR0FBSSxFQUZpQlYsRUFBWVksQ0FBVSxHQUFLVCxFQUFZVSxDQUFXLEdBSXJFLFNBSUYsSUFBTUMsRUFBYXJCLEVBQWNpQixFQUFVLGFBQWNuQixFQUFlLElBQUksRUFDdEV3QixFQUFhdEIsRUFBY2lCLEVBQVUsY0FBZW5CLEVBQWUsSUFBSSxFQUd2RXlCLEVBQWVGLEVBQWEsR0FBS0MsRUFBYSxFQUNoREQsRUFBYUMsRUFDYixFQUdKUCxFQUFJLFlBQVksS0FBSyxVQUFXLENBQzlCLFdBQVlELEVBQUcsS0FDZixPQUFRQSxFQUFHLEtBQ1gsT0FBUUksRUFDUixVQUFXLE9BQU9ELEVBQVUsU0FBUyxFQUNyQyxXQUFBSSxFQUNBLFdBQUFDLEVBQ0EsYUFBQUMsRUFDQSxXQUFBSixFQUNBLFlBQUFDLEVBQ0EsUUFBU04sRUFBRyxTQUFTLFNBQVMsR0FBSyxJQUNuQyxRQUFTQSxFQUFHLE9BQ2QsQ0FBQyxFQUdEQyxFQUFJLE1BQU0sUUFBUSxlQUFlLEVBQUUsSUFBSSxFQUFHLENBQUUsT0FBUUcsQ0FBTyxDQUFDLEVBQzVESCxFQUFJLE1BQU0sUUFBUSxvQkFBb0IsRUFBRSxJQUFJTSxFQUFZLENBQUUsT0FBUUgsQ0FBTyxDQUFDLEVBQzFFSCxFQUFJLE1BQU0sUUFBUSxvQkFBb0IsRUFBRSxJQUFJTyxFQUFZLENBQUUsT0FBUUosQ0FBTyxDQUFDLEVBQzFFSCxFQUFJLE1BQU0sTUFBTSxlQUFlLEVBQUUsT0FBT1EsRUFBYyxDQUFFLE9BQVFMLENBQU8sQ0FBQyxDQUMxRSxDQUNGLEVBQ0EsQ0FBRSxjQUFlLEVBQU0sQ0FDekIsRUFDQyxPQUFPLGNBQWMsRUFBRSxLQUFNTSxHQUFNQSxFQUFFLE9BQU8sTUFBTSxFQUFFLENBQUMiLAogICJuYW1lcyI6IFsiQXB0b3NNb2R1bGVzUHJvY2Vzc29yIiwgIkFwdG9zTmV0d29yayIsICJNT1NBSUNfUk9VVEVSIiwgIlVTRENfQUREUkVTUyIsICJUT0tFTl9ERUNJTUFMUyIsICJCVVlCQUNLX1dBTExFVFMiLCAiZnJvbVJhd0Ftb3VudCIsICJyYXdBbW91bnQiLCAiZGVjaW1hbHMiLCAiX19uYW1lIiwgImlzQnV5YmFja1dhbGxldCIsICJhZGRyZXNzIiwgIndhbGxldCIsICJpc1VzZGNBc3NldCIsICJhc3NldCIsICJVU0RDX0FERFJFU1MiLCAiaXNNb3ZlQXNzZXQiLCAiQXB0b3NNb2R1bGVzUHJvY2Vzc29yIiwgIk1PU0FJQ19ST1VURVIiLCAiQXB0b3NOZXR3b3JrIiwgInR4IiwgImN0eCIsICJldmVudCIsICJldmVudERhdGEiLCAic2VuZGVyIiwgImlucHV0QXNzZXQiLCAib3V0cHV0QXNzZXQiLCAidXNkY0Ftb3VudCIsICJtb3ZlQW1vdW50IiwgInByaWNlUGVyTW92ZSIsICJwIl0KfQo=