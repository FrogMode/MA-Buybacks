import { createRequire } from 'module'; const require = createRequire(import.meta.url);
var w=Object.defineProperty;var c=(e,t)=>w(e,"name",{value:t,configurable:!0});import{AptosModulesProcessor as g,AptosNetwork as C}from"@sentio/sdk/aptos";var _="0x3f7399a0d3d646ce94ee0badf16c4c3f3c656fe3a5e142e83b5ebc011aa8b3d",b={MOVE:8,USDC:6},m=["0x682330a16592406f9f4fd5b4822cbe01af2f227825b9711d166fcea5e0ca4838","0x28b57594e3c48fd4303887482a0667127fc761a20f5c3bd9401c5841904e322a"];function y(e,t){return(typeof e=="bigint"?Number(e):typeof e=="string"?parseInt(e,10):e)/Math.pow(10,t)}c(y,"fromRawAmount");function v(e){return m.length===0?!0:m.some(t=>t.toLowerCase()===e.toLowerCase())}c(v,"isBuybackWallet");g.bind({address:_,network:C.MOVEMENT_MAIN_NET,startVersion:0n}).onTransaction(async(e,t)=>{let r=e.payload;if(!r||r.type!=="entry_function_payload")return;let i=r;if(!i.function.includes("::router::swap"))return;let s=e.sender;if(!v(s))return;let u=i.type_arguments||[],d=u[0]||"",f=u[1]||"";if(!(d.toLowerCase().includes("usdc")&&f.toLowerCase().includes("aptos_coin")))return;let o=0,n=0;if(e.events)for(let a of e.events){let p=a.data;a.type.toLowerCase().includes("withdraw")&&a.type.toLowerCase().includes("usdc")&&(o=y(p?.amount||0,b.USDC)),a.type.toLowerCase().includes("deposit")&&a.type.toLowerCase().includes("aptoscoin")&&(n=y(p?.amount||0,b.MOVE))}let l=o>0&&n>0?o/n:0;t.eventLogger.emit("buyback",{distinctId:e.hash,txHash:e.hash,wallet:s,timestamp:Number(e.timestamp)/1e3,usdcAmount:o,moveAmount:n,pricePerMove:l,srcAsset:d,dstAsset:f,version:e.version?.toString()||"0",success:e.success}),t.meter.Counter("buyback_count").add(1,{wallet:s}),t.meter.Counter("buyback_usdc_total").add(o,{wallet:s}),t.meter.Counter("buyback_move_total").add(n,{wallet:s}),t.meter.Gauge("buyback_price").record(l,{wallet:s})},{includeFailed:!1});import("node:process").then(e=>e.stdout.write(""));
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL3Byb2Nlc3Nvci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXB0b3NNb2R1bGVzUHJvY2Vzc29yLCBBcHRvc0NvbnRleHQsIEFwdG9zTmV0d29yayB9IGZyb20gXCJAc2VudGlvL3Nkay9hcHRvc1wiXG5pbXBvcnQgdHlwZSB7IFVzZXJUcmFuc2FjdGlvblJlc3BvbnNlIH0gZnJvbSBcIkBhcHRvcy1sYWJzL3RzLXNka1wiO1xuXG4vLyBNb3NhaWMgUm91dGVyIGNvbnRyYWN0IGFkZHJlc3Mgb24gTW92ZW1lbnQgbWFpbm5ldFxuLy8gTm90ZTogVGhpcyBpcyB0aGUgYWN0dWFsIHJvdXRlciBiZWluZyB1c2VkIGJ5IE1vc2FpYyBBUElcbmNvbnN0IE1PU0FJQ19ST1VURVIgPSBcIjB4M2Y3Mzk5YTBkM2Q2NDZjZTk0ZWUwYmFkZjE2YzRjM2YzYzY1NmZlM2E1ZTE0MmU4M2I1ZWJjMDExYWE4YjNkXCI7XG5cbi8vIFRva2VuIGRlY2ltYWxzXG5jb25zdCBUT0tFTl9ERUNJTUFMUyA9IHtcbiAgTU9WRTogOCxcbiAgVVNEQzogNixcbn0gYXMgY29uc3Q7XG5cbi8vIEJ1eWJhY2sgd2FsbGV0IGFkZHJlc3NlcyB0byB0cmFja1xuY29uc3QgQlVZQkFDS19XQUxMRVRTOiBzdHJpbmdbXSA9IFtcbiAgLy8gTWFudWFsIGJ1eWJhY2sgd2FsbGV0XG4gIFwiMHg2ODIzMzBhMTY1OTI0MDZmOWY0ZmQ1YjQ4MjJjYmUwMWFmMmYyMjc4MjViOTcxMWQxNjZmY2VhNWUwY2E0ODM4XCIsXG4gIC8vIFRXQVAgQm90IGV4ZWN1dG9yIHdhbGxldFxuICBcIjB4MjhiNTc1OTRlM2M0OGZkNDMwMzg4NzQ4MmEwNjY3MTI3ZmM3NjFhMjBmNWMzYmQ5NDAxYzU4NDE5MDRlMzIyYVwiLFxuXTtcblxuLyoqXG4gKiBDb252ZXJ0IHJhdyBhbW91bnQgdG8gaHVtYW4tcmVhZGFibGUgYW1vdW50XG4gKi9cbmZ1bmN0aW9uIGZyb21SYXdBbW91bnQocmF3QW1vdW50OiBiaWdpbnQgfCBudW1iZXIgfCBzdHJpbmcsIGRlY2ltYWxzOiBudW1iZXIpOiBudW1iZXIge1xuICBjb25zdCByYXcgPSB0eXBlb2YgcmF3QW1vdW50ID09PSBcImJpZ2ludFwiID8gTnVtYmVyKHJhd0Ftb3VudCkgOiBcbiAgICAgICAgICAgICAgdHlwZW9mIHJhd0Ftb3VudCA9PT0gXCJzdHJpbmdcIiA/IHBhcnNlSW50KHJhd0Ftb3VudCwgMTApIDogcmF3QW1vdW50O1xuICByZXR1cm4gcmF3IC8gTWF0aC5wb3coMTAsIGRlY2ltYWxzKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhbiBhZGRyZXNzIGlzIGEgdHJhY2tlZCBidXliYWNrIHdhbGxldFxuICovXG5mdW5jdGlvbiBpc0J1eWJhY2tXYWxsZXQoYWRkcmVzczogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGlmIChCVVlCQUNLX1dBTExFVFMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIEJVWUJBQ0tfV0FMTEVUUy5zb21lKFxuICAgICh3YWxsZXQpID0+IHdhbGxldC50b0xvd2VyQ2FzZSgpID09PSBhZGRyZXNzLnRvTG93ZXJDYXNlKClcbiAgKTtcbn1cblxuLyoqXG4gKiBQcm9jZXNzIE1vc2FpYyByb3V0ZXIgc3dhcCBldmVudHNcbiAqL1xuQXB0b3NNb2R1bGVzUHJvY2Vzc29yLmJpbmQoe1xuICBhZGRyZXNzOiBNT1NBSUNfUk9VVEVSLFxuICBuZXR3b3JrOiBBcHRvc05ldHdvcmsuTU9WRU1FTlRfTUFJTl9ORVQsXG4gIHN0YXJ0VmVyc2lvbjogMG4sXG59KS5vblRyYW5zYWN0aW9uKFxuICBhc3luYyAodHg6IFVzZXJUcmFuc2FjdGlvblJlc3BvbnNlLCBjdHg6IEFwdG9zQ29udGV4dCkgPT4ge1xuICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBzd2FwIHRyYW5zYWN0aW9uXG4gICAgY29uc3QgcGF5bG9hZCA9IHR4LnBheWxvYWQ7XG4gICAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQudHlwZSAhPT0gXCJlbnRyeV9mdW5jdGlvbl9wYXlsb2FkXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBmdW5jdGlvblBheWxvYWQgPSBwYXlsb2FkIGFzIHtcbiAgICAgIGZ1bmN0aW9uOiBzdHJpbmc7XG4gICAgICB0eXBlX2FyZ3VtZW50czogc3RyaW5nW107XG4gICAgICBhcmd1bWVudHM6IGFueVtdO1xuICAgIH07XG5cbiAgICAvLyBDaGVjayBpZiBpdCdzIGEgTW9zYWljIHJvdXRlciBzd2FwIGZ1bmN0aW9uXG4gICAgaWYgKCFmdW5jdGlvblBheWxvYWQuZnVuY3Rpb24uaW5jbHVkZXMoXCI6OnJvdXRlcjo6c3dhcFwiKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHNlbmRlciA9IHR4LnNlbmRlcjtcbiAgICBcbiAgICAvLyBPbmx5IHByb2Nlc3MgdHJhbnNhY3Rpb25zIGZyb20gdHJhY2tlZCBidXliYWNrIHdhbGxldHNcbiAgICBpZiAoIWlzQnV5YmFja1dhbGxldChzZW5kZXIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCB0eXBlIGFyZ3VtZW50cyB0byBkZXRlcm1pbmUgc3dhcCBkaXJlY3Rpb25cbiAgICBjb25zdCB0eXBlQXJncyA9IGZ1bmN0aW9uUGF5bG9hZC50eXBlX2FyZ3VtZW50cyB8fCBbXTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgVVNEQyAtPiBNT1ZFIHN3YXAgKGJ1eWJhY2spXG4gICAgY29uc3Qgc3JjQXNzZXQgPSB0eXBlQXJnc1swXSB8fCBcIlwiO1xuICAgIGNvbnN0IGRzdEFzc2V0ID0gdHlwZUFyZ3NbMV0gfHwgXCJcIjtcbiAgICBcbiAgICBjb25zdCBpc1VzZGNUb01vdmUgPSBcbiAgICAgIHNyY0Fzc2V0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJ1c2RjXCIpICYmIFxuICAgICAgZHN0QXNzZXQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImFwdG9zX2NvaW5cIik7XG4gICAgXG4gICAgaWYgKCFpc1VzZGNUb01vdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IGFtb3VudHMgZnJvbSB0cmFuc2FjdGlvbiBldmVudHNcbiAgICBsZXQgdXNkY0Ftb3VudCA9IDA7XG4gICAgbGV0IG1vdmVBbW91bnQgPSAwO1xuXG4gICAgLy8gUGFyc2UgZXZlbnRzIHRvIGdldCBhY3R1YWwgc3dhcCBhbW91bnRzXG4gICAgaWYgKHR4LmV2ZW50cykge1xuICAgICAgZm9yIChjb25zdCBldmVudCBvZiB0eC5ldmVudHMpIHtcbiAgICAgICAgY29uc3QgZXZlbnREYXRhID0gZXZlbnQuZGF0YSBhcyB7IGFtb3VudD86IHN0cmluZyB8IG51bWJlciB9O1xuICAgICAgICAvLyBMb29rIGZvciBjb2luIHdpdGhkcmF3IGV2ZW50cyAoVVNEQyBzcGVudClcbiAgICAgICAgaWYgKGV2ZW50LnR5cGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcIndpdGhkcmF3XCIpICYmIGV2ZW50LnR5cGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcInVzZGNcIikpIHtcbiAgICAgICAgICB1c2RjQW1vdW50ID0gZnJvbVJhd0Ftb3VudChldmVudERhdGE/LmFtb3VudCB8fCAwLCBUT0tFTl9ERUNJTUFMUy5VU0RDKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBMb29rIGZvciBjb2luIGRlcG9zaXQgZXZlbnRzIChNT1ZFIHJlY2VpdmVkKVxuICAgICAgICBpZiAoZXZlbnQudHlwZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZGVwb3NpdFwiKSAmJiBldmVudC50eXBlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJhcHRvc2NvaW5cIikpIHtcbiAgICAgICAgICBtb3ZlQW1vdW50ID0gZnJvbVJhd0Ftb3VudChldmVudERhdGE/LmFtb3VudCB8fCAwLCBUT0tFTl9ERUNJTUFMUy5NT1ZFKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBlZmZlY3RpdmUgcHJpY2VcbiAgICBjb25zdCBwcmljZVBlck1vdmUgPSB1c2RjQW1vdW50ID4gMCAmJiBtb3ZlQW1vdW50ID4gMCBcbiAgICAgID8gdXNkY0Ftb3VudCAvIG1vdmVBbW91bnQgXG4gICAgICA6IDA7XG5cbiAgICAvLyBMb2cgdGhlIGJ1eWJhY2sgZXZlbnRcbiAgICBjdHguZXZlbnRMb2dnZXIuZW1pdChcImJ1eWJhY2tcIiwge1xuICAgICAgZGlzdGluY3RJZDogdHguaGFzaCxcbiAgICAgIHR4SGFzaDogdHguaGFzaCxcbiAgICAgIHdhbGxldDogc2VuZGVyLFxuICAgICAgdGltZXN0YW1wOiBOdW1iZXIodHgudGltZXN0YW1wKSAvIDEwMDAsXG4gICAgICB1c2RjQW1vdW50LFxuICAgICAgbW92ZUFtb3VudCxcbiAgICAgIHByaWNlUGVyTW92ZSxcbiAgICAgIHNyY0Fzc2V0LFxuICAgICAgZHN0QXNzZXQsXG4gICAgICB2ZXJzaW9uOiB0eC52ZXJzaW9uPy50b1N0cmluZygpIHx8IFwiMFwiLFxuICAgICAgc3VjY2VzczogdHguc3VjY2VzcyxcbiAgICB9KTtcblxuICAgIC8vIEVtaXQgbWV0cmljcyBmb3IgZGFzaGJvYXJkc1xuICAgIGN0eC5tZXRlci5Db3VudGVyKFwiYnV5YmFja19jb3VudFwiKS5hZGQoMSwgeyB3YWxsZXQ6IHNlbmRlciB9KTtcbiAgICBjdHgubWV0ZXIuQ291bnRlcihcImJ1eWJhY2tfdXNkY190b3RhbFwiKS5hZGQodXNkY0Ftb3VudCwgeyB3YWxsZXQ6IHNlbmRlciB9KTtcbiAgICBjdHgubWV0ZXIuQ291bnRlcihcImJ1eWJhY2tfbW92ZV90b3RhbFwiKS5hZGQobW92ZUFtb3VudCwgeyB3YWxsZXQ6IHNlbmRlciB9KTtcbiAgICBjdHgubWV0ZXIuR2F1Z2UoXCJidXliYWNrX3ByaWNlXCIpLnJlY29yZChwcmljZVBlck1vdmUsIHsgd2FsbGV0OiBzZW5kZXIgfSk7XG4gIH0sXG4gIHsgaW5jbHVkZUZhaWxlZDogZmFsc2UgfVxuKTtcbjtpbXBvcnQoXCJub2RlOnByb2Nlc3NcIikudGhlbigocCkgPT4gcC5zdGRvdXQud3JpdGUoXCJcIikpOyJdLAogICJtYXBwaW5ncyI6ICI7K0VBQUEsT0FBUyx5QkFBQUEsRUFBcUMsZ0JBQUFDLE1BQW9CLG9CQUtsRSxJQUFNQyxFQUFnQixvRUFHaEJDLEVBQWlCLENBQ3JCLEtBQU0sRUFDTixLQUFNLENBQ1IsRUFHTUMsRUFBNEIsQ0FFaEMscUVBRUEsb0VBQ0YsRUFLQSxTQUFTQyxFQUFjQyxFQUFxQ0MsRUFBMEIsQ0FHcEYsT0FGWSxPQUFPRCxHQUFjLFNBQVcsT0FBT0EsQ0FBUyxFQUNoRCxPQUFPQSxHQUFjLFNBQVcsU0FBU0EsRUFBVyxFQUFFLEVBQUlBLEdBQ3pELEtBQUssSUFBSSxHQUFJQyxDQUFRLENBQ3BDLENBSlNDLEVBQUFILEVBQUEsaUJBU1QsU0FBU0ksRUFBZ0JDLEVBQTBCLENBQ2pELE9BQUlOLEVBQWdCLFNBQVcsRUFDdEIsR0FFRkEsRUFBZ0IsS0FDcEJPLEdBQVdBLEVBQU8sWUFBWSxJQUFNRCxFQUFRLFlBQVksQ0FDM0QsQ0FDRixDQVBTRixFQUFBQyxFQUFBLG1CQVlURyxFQUFzQixLQUFLLENBQ3pCLFFBQVNWLEVBQ1QsUUFBU1csRUFBYSxrQkFDdEIsYUFBYyxFQUNoQixDQUFDLEVBQUUsY0FDRCxNQUFPQyxFQUE2QkMsSUFBc0IsQ0FFeEQsSUFBTUMsRUFBVUYsRUFBRyxRQUNuQixHQUFJLENBQUNFLEdBQVdBLEVBQVEsT0FBUyx5QkFDL0IsT0FHRixJQUFNQyxFQUFrQkQsRUFPeEIsR0FBSSxDQUFDQyxFQUFnQixTQUFTLFNBQVMsZ0JBQWdCLEVBQ3JELE9BR0YsSUFBTUMsRUFBU0osRUFBRyxPQUdsQixHQUFJLENBQUNMLEVBQWdCUyxDQUFNLEVBQ3pCLE9BSUYsSUFBTUMsRUFBV0YsRUFBZ0IsZ0JBQWtCLENBQUMsRUFHOUNHLEVBQVdELEVBQVMsQ0FBQyxHQUFLLEdBQzFCRSxFQUFXRixFQUFTLENBQUMsR0FBSyxHQU1oQyxHQUFJLEVBSEZDLEVBQVMsWUFBWSxFQUFFLFNBQVMsTUFBTSxHQUN0Q0MsRUFBUyxZQUFZLEVBQUUsU0FBUyxZQUFZLEdBRzVDLE9BSUYsSUFBSUMsRUFBYSxFQUNiQyxFQUFhLEVBR2pCLEdBQUlULEVBQUcsT0FDTCxRQUFXVSxLQUFTVixFQUFHLE9BQVEsQ0FDN0IsSUFBTVcsRUFBWUQsRUFBTSxLQUVwQkEsRUFBTSxLQUFLLFlBQVksRUFBRSxTQUFTLFVBQVUsR0FBS0EsRUFBTSxLQUFLLFlBQVksRUFBRSxTQUFTLE1BQU0sSUFDM0ZGLEVBQWFqQixFQUFjb0IsR0FBVyxRQUFVLEVBQUd0QixFQUFlLElBQUksR0FHcEVxQixFQUFNLEtBQUssWUFBWSxFQUFFLFNBQVMsU0FBUyxHQUFLQSxFQUFNLEtBQUssWUFBWSxFQUFFLFNBQVMsV0FBVyxJQUMvRkQsRUFBYWxCLEVBQWNvQixHQUFXLFFBQVUsRUFBR3RCLEVBQWUsSUFBSSxFQUUxRSxDQUlGLElBQU11QixFQUFlSixFQUFhLEdBQUtDLEVBQWEsRUFDaERELEVBQWFDLEVBQ2IsRUFHSlIsRUFBSSxZQUFZLEtBQUssVUFBVyxDQUM5QixXQUFZRCxFQUFHLEtBQ2YsT0FBUUEsRUFBRyxLQUNYLE9BQVFJLEVBQ1IsVUFBVyxPQUFPSixFQUFHLFNBQVMsRUFBSSxJQUNsQyxXQUFBUSxFQUNBLFdBQUFDLEVBQ0EsYUFBQUcsRUFDQSxTQUFBTixFQUNBLFNBQUFDLEVBQ0EsUUFBU1AsRUFBRyxTQUFTLFNBQVMsR0FBSyxJQUNuQyxRQUFTQSxFQUFHLE9BQ2QsQ0FBQyxFQUdEQyxFQUFJLE1BQU0sUUFBUSxlQUFlLEVBQUUsSUFBSSxFQUFHLENBQUUsT0FBUUcsQ0FBTyxDQUFDLEVBQzVESCxFQUFJLE1BQU0sUUFBUSxvQkFBb0IsRUFBRSxJQUFJTyxFQUFZLENBQUUsT0FBUUosQ0FBTyxDQUFDLEVBQzFFSCxFQUFJLE1BQU0sUUFBUSxvQkFBb0IsRUFBRSxJQUFJUSxFQUFZLENBQUUsT0FBUUwsQ0FBTyxDQUFDLEVBQzFFSCxFQUFJLE1BQU0sTUFBTSxlQUFlLEVBQUUsT0FBT1csRUFBYyxDQUFFLE9BQVFSLENBQU8sQ0FBQyxDQUMxRSxFQUNBLENBQUUsY0FBZSxFQUFNLENBQ3pCLEVBQ0MsT0FBTyxjQUFjLEVBQUUsS0FBTVMsR0FBTUEsRUFBRSxPQUFPLE1BQU0sRUFBRSxDQUFDIiwKICAibmFtZXMiOiBbIkFwdG9zTW9kdWxlc1Byb2Nlc3NvciIsICJBcHRvc05ldHdvcmsiLCAiTU9TQUlDX1JPVVRFUiIsICJUT0tFTl9ERUNJTUFMUyIsICJCVVlCQUNLX1dBTExFVFMiLCAiZnJvbVJhd0Ftb3VudCIsICJyYXdBbW91bnQiLCAiZGVjaW1hbHMiLCAiX19uYW1lIiwgImlzQnV5YmFja1dhbGxldCIsICJhZGRyZXNzIiwgIndhbGxldCIsICJBcHRvc01vZHVsZXNQcm9jZXNzb3IiLCAiQXB0b3NOZXR3b3JrIiwgInR4IiwgImN0eCIsICJwYXlsb2FkIiwgImZ1bmN0aW9uUGF5bG9hZCIsICJzZW5kZXIiLCAidHlwZUFyZ3MiLCAic3JjQXNzZXQiLCAiZHN0QXNzZXQiLCAidXNkY0Ftb3VudCIsICJtb3ZlQW1vdW50IiwgImV2ZW50IiwgImV2ZW50RGF0YSIsICJwcmljZVBlck1vdmUiLCAicCJdCn0K