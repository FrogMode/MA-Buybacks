import { createRequire } from 'module'; const require = createRequire(import.meta.url);
var l=Object.defineProperty;var o=(e,t)=>l(e,"name",{value:t,configurable:!0});import{AptosModulesProcessor as _,AptosNetwork as g}from"@sentio/sdk/aptos";var p="0x3f7399a0d3d646ce94ee0badf16c4c3f3c656fe3a5e142e83b5ebc011aa8b3d",v="0x83121c9f9b0527d1f056e21a950d6bf3b9e9e2e8353d0e95ccea726713cbea39";var b={MOVE:8,USDC:6},f=["0x682330a16592406f9f4fd5b4822cbe01af2f227825b9711d166fcea5e0ca4838","0x28b57594e3c48fd4303887482a0667127fc761a20f5c3bd9401c5841904e322a"];function m(e,t){return(typeof e=="bigint"?Number(e):typeof e=="string"?parseInt(e,10):e)/Math.pow(10,t)}o(m,"fromRawAmount");function C(e){return f.length===0?!0:f.some(t=>t.toLowerCase()===e.toLowerCase())}o(C,"isBuybackWallet");function w(e){return e.toLowerCase()===v.toLowerCase()}o(w,"isUsdcAsset");function A(e){return e.toLowerCase().includes("aptos_coin")}o(A,"isMoveAsset");_.bind({address:p,network:g.MOVEMENT_MAIN_NET,startVersion:58000000n}).onTransaction(async(e,t)=>{if(e.success&&e.events)for(let i of e.events){if(!i.type.includes(`${p}::router::SwapEvent`))continue;let s=i.data,n=s.sender;if(!C(n))continue;let c=s.input_asset,u=s.output_asset;if(!(w(c)&&A(u)))continue;let a=m(s.input_amount,b.USDC),r=m(s.output_amount,b.MOVE),d=a>0&&r>0?a/r:0;t.eventLogger.emit("buyback",{distinctId:e.hash,txHash:e.hash,wallet:n,timestamp:Number(s.timestamp),usdcAmount:a,moveAmount:r,pricePerMove:d,inputAsset:c,outputAsset:u,version:e.version?.toString()||"0",success:e.success}),t.meter.Counter("buyback_count").add(1,{wallet:n}),t.meter.Counter("buyback_usdc_total").add(a,{wallet:n}),t.meter.Counter("buyback_move_total").add(r,{wallet:n}),t.meter.Gauge("buyback_price").record(d,{wallet:n})}},{includeFailed:!1});import("node:process").then(e=>e.stdout.write(""));
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL3Byb2Nlc3Nvci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXB0b3NNb2R1bGVzUHJvY2Vzc29yLCBBcHRvc0NvbnRleHQsIEFwdG9zTmV0d29yayB9IGZyb20gXCJAc2VudGlvL3Nkay9hcHRvc1wiXG5pbXBvcnQgdHlwZSB7IFVzZXJUcmFuc2FjdGlvblJlc3BvbnNlIH0gZnJvbSBcIkBhcHRvcy1sYWJzL3RzLXNka1wiO1xuXG4vLyBNb3NhaWMgUm91dGVyIGNvbnRyYWN0IGFkZHJlc3Mgb24gTW92ZW1lbnQgbWFpbm5ldFxuY29uc3QgTU9TQUlDX1JPVVRFUiA9IFwiMHgzZjczOTlhMGQzZDY0NmNlOTRlZTBiYWRmMTZjNGMzZjNjNjU2ZmUzYTVlMTQyZTgzYjVlYmMwMTFhYThiM2RcIjtcblxuLy8gVG9rZW4gYWRkcmVzc2VzXG5jb25zdCBVU0RDX0FERFJFU1MgPSBcIjB4ODMxMjFjOWY5YjA1MjdkMWYwNTZlMjFhOTUwZDZiZjNiOWU5ZTJlODM1M2QwZTk1Y2NlYTcyNjcxM2NiZWEzOVwiO1xuY29uc3QgTU9WRV9BRERSRVNTID0gXCIweDE6OmFwdG9zX2NvaW46OkFwdG9zQ29pblwiO1xuXG4vLyBUb2tlbiBkZWNpbWFsc1xuY29uc3QgVE9LRU5fREVDSU1BTFMgPSB7XG4gIE1PVkU6IDgsXG4gIFVTREM6IDYsXG59IGFzIGNvbnN0O1xuXG4vLyBCdXliYWNrIHdhbGxldCBhZGRyZXNzZXMgdG8gdHJhY2tcbmNvbnN0IEJVWUJBQ0tfV0FMTEVUUzogc3RyaW5nW10gPSBbXG4gIC8vIE1hbnVhbCBidXliYWNrIHdhbGxldFxuICBcIjB4NjgyMzMwYTE2NTkyNDA2ZjlmNGZkNWI0ODIyY2JlMDFhZjJmMjI3ODI1Yjk3MTFkMTY2ZmNlYTVlMGNhNDgzOFwiLFxuICAvLyBUV0FQIEJvdCBleGVjdXRvciB3YWxsZXRcbiAgXCIweDI4YjU3NTk0ZTNjNDhmZDQzMDM4ODc0ODJhMDY2NzEyN2ZjNzYxYTIwZjVjM2JkOTQwMWM1ODQxOTA0ZTMyMmFcIixcbl07XG5cbi8qKlxuICogQ29udmVydCByYXcgYW1vdW50IHRvIGh1bWFuLXJlYWRhYmxlIGFtb3VudFxuICovXG5mdW5jdGlvbiBmcm9tUmF3QW1vdW50KHJhd0Ftb3VudDogYmlnaW50IHwgbnVtYmVyIHwgc3RyaW5nLCBkZWNpbWFsczogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3QgcmF3ID0gdHlwZW9mIHJhd0Ftb3VudCA9PT0gXCJiaWdpbnRcIiA/IE51bWJlcihyYXdBbW91bnQpIDogXG4gICAgICAgICAgICAgIHR5cGVvZiByYXdBbW91bnQgPT09IFwic3RyaW5nXCIgPyBwYXJzZUludChyYXdBbW91bnQsIDEwKSA6IHJhd0Ftb3VudDtcbiAgcmV0dXJuIHJhdyAvIE1hdGgucG93KDEwLCBkZWNpbWFscyk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWRkcmVzcyBpcyBhIHRyYWNrZWQgYnV5YmFjayB3YWxsZXRcbiAqL1xuZnVuY3Rpb24gaXNCdXliYWNrV2FsbGV0KGFkZHJlc3M6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBpZiAoQlVZQkFDS19XQUxMRVRTLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBCVVlCQUNLX1dBTExFVFMuc29tZShcbiAgICAod2FsbGV0KSA9PiB3YWxsZXQudG9Mb3dlckNhc2UoKSA9PT0gYWRkcmVzcy50b0xvd2VyQ2FzZSgpXG4gICk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYXNzZXQgaXMgVVNEQ1xuICovXG5mdW5jdGlvbiBpc1VzZGNBc3NldChhc3NldDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBhc3NldC50b0xvd2VyQ2FzZSgpID09PSBVU0RDX0FERFJFU1MudG9Mb3dlckNhc2UoKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhc3NldCBpcyBNT1ZFXG4gKi9cbmZ1bmN0aW9uIGlzTW92ZUFzc2V0KGFzc2V0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIGFzc2V0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJhcHRvc19jb2luXCIpO1xufVxuXG4vLyBEZWZpbmUgdGhlIFN3YXBFdmVudCBkYXRhIHN0cnVjdHVyZVxuaW50ZXJmYWNlIFN3YXBFdmVudERhdGEge1xuICBzZW5kZXI6IHN0cmluZztcbiAgcmVjZWl2ZXI6IHN0cmluZztcbiAgaW5wdXRfYXNzZXQ6IHN0cmluZztcbiAgb3V0cHV0X2Fzc2V0OiBzdHJpbmc7XG4gIGlucHV0X2Ftb3VudDogc3RyaW5nO1xuICBvdXRwdXRfYW1vdW50OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBleHRyYV9kYXRhPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb2Nlc3MgTW9zYWljIHJvdXRlciBzd2FwIGV2ZW50c1xuICovXG5BcHRvc01vZHVsZXNQcm9jZXNzb3IuYmluZCh7XG4gIGFkZHJlc3M6IE1PU0FJQ19ST1VURVIsXG4gIG5ldHdvcms6IEFwdG9zTmV0d29yay5NT1ZFTUVOVF9NQUlOX05FVCxcbiAgLy8gU3RhcnQgZnJvbSB2ZXJzaW9uIDU4MDAwMDAwIHRvIHNwZWVkIHVwIGluZGV4aW5nIChmaXJzdCBUV0FQIHN3YXBzIGFyZSBhcm91bmQgNTg1MzUxOTEpXG4gIHN0YXJ0VmVyc2lvbjogNTgwMDAwMDBuLFxufSkub25UcmFuc2FjdGlvbihcbiAgYXN5bmMgKHR4OiBVc2VyVHJhbnNhY3Rpb25SZXNwb25zZSwgY3R4OiBBcHRvc0NvbnRleHQpID0+IHtcbiAgICAvLyBTa2lwIGZhaWxlZCB0cmFuc2FjdGlvbnNcbiAgICBpZiAoIXR4LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBMb29rIGZvciBTd2FwRXZlbnQgZnJvbSBNb3NhaWMgcm91dGVyXG4gICAgaWYgKCF0eC5ldmVudHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIHR4LmV2ZW50cykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIE1vc2FpYyBTd2FwRXZlbnRcbiAgICAgIGlmICghZXZlbnQudHlwZS5pbmNsdWRlcyhgJHtNT1NBSUNfUk9VVEVSfTo6cm91dGVyOjpTd2FwRXZlbnRgKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZXZlbnREYXRhID0gZXZlbnQuZGF0YSBhcyBTd2FwRXZlbnREYXRhO1xuICAgICAgY29uc3Qgc2VuZGVyID0gZXZlbnREYXRhLnNlbmRlcjtcblxuICAgICAgLy8gT25seSBwcm9jZXNzIHRyYW5zYWN0aW9ucyBmcm9tIHRyYWNrZWQgYnV5YmFjayB3YWxsZXRzXG4gICAgICBpZiAoIWlzQnV5YmFja1dhbGxldChzZW5kZXIpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgVVNEQyAtPiBNT1ZFIHN3YXAgKGJ1eWJhY2spXG4gICAgICBjb25zdCBpbnB1dEFzc2V0ID0gZXZlbnREYXRhLmlucHV0X2Fzc2V0O1xuICAgICAgY29uc3Qgb3V0cHV0QXNzZXQgPSBldmVudERhdGEub3V0cHV0X2Fzc2V0O1xuXG4gICAgICBjb25zdCBpc1VzZGNUb01vdmUgPSBpc1VzZGNBc3NldChpbnB1dEFzc2V0KSAmJiBpc01vdmVBc3NldChvdXRwdXRBc3NldCk7XG5cbiAgICAgIGlmICghaXNVc2RjVG9Nb3ZlKSB7XG4gICAgICAgIC8vIFNraXAgbm9uLWJ1eWJhY2sgc3dhcHMgKGUuZy4sIE1PVkUgLT4gVVNEQyB3b3VsZCBiZSBhIHNlbGwpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBQYXJzZSBhbW91bnRzXG4gICAgICBjb25zdCB1c2RjQW1vdW50ID0gZnJvbVJhd0Ftb3VudChldmVudERhdGEuaW5wdXRfYW1vdW50LCBUT0tFTl9ERUNJTUFMUy5VU0RDKTtcbiAgICAgIGNvbnN0IG1vdmVBbW91bnQgPSBmcm9tUmF3QW1vdW50KGV2ZW50RGF0YS5vdXRwdXRfYW1vdW50LCBUT0tFTl9ERUNJTUFMUy5NT1ZFKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGVmZmVjdGl2ZSBwcmljZVxuICAgICAgY29uc3QgcHJpY2VQZXJNb3ZlID0gdXNkY0Ftb3VudCA+IDAgJiYgbW92ZUFtb3VudCA+IDAgXG4gICAgICAgID8gdXNkY0Ftb3VudCAvIG1vdmVBbW91bnQgXG4gICAgICAgIDogMDtcblxuICAgICAgLy8gTG9nIHRoZSBidXliYWNrIGV2ZW50XG4gICAgICBjdHguZXZlbnRMb2dnZXIuZW1pdChcImJ1eWJhY2tcIiwge1xuICAgICAgICBkaXN0aW5jdElkOiB0eC5oYXNoLFxuICAgICAgICB0eEhhc2g6IHR4Lmhhc2gsXG4gICAgICAgIHdhbGxldDogc2VuZGVyLFxuICAgICAgICB0aW1lc3RhbXA6IE51bWJlcihldmVudERhdGEudGltZXN0YW1wKSxcbiAgICAgICAgdXNkY0Ftb3VudCxcbiAgICAgICAgbW92ZUFtb3VudCxcbiAgICAgICAgcHJpY2VQZXJNb3ZlLFxuICAgICAgICBpbnB1dEFzc2V0LFxuICAgICAgICBvdXRwdXRBc3NldCxcbiAgICAgICAgdmVyc2lvbjogdHgudmVyc2lvbj8udG9TdHJpbmcoKSB8fCBcIjBcIixcbiAgICAgICAgc3VjY2VzczogdHguc3VjY2VzcyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBFbWl0IG1ldHJpY3MgZm9yIGRhc2hib2FyZHNcbiAgICAgIGN0eC5tZXRlci5Db3VudGVyKFwiYnV5YmFja19jb3VudFwiKS5hZGQoMSwgeyB3YWxsZXQ6IHNlbmRlciB9KTtcbiAgICAgIGN0eC5tZXRlci5Db3VudGVyKFwiYnV5YmFja191c2RjX3RvdGFsXCIpLmFkZCh1c2RjQW1vdW50LCB7IHdhbGxldDogc2VuZGVyIH0pO1xuICAgICAgY3R4Lm1ldGVyLkNvdW50ZXIoXCJidXliYWNrX21vdmVfdG90YWxcIikuYWRkKG1vdmVBbW91bnQsIHsgd2FsbGV0OiBzZW5kZXIgfSk7XG4gICAgICBjdHgubWV0ZXIuR2F1Z2UoXCJidXliYWNrX3ByaWNlXCIpLnJlY29yZChwcmljZVBlck1vdmUsIHsgd2FsbGV0OiBzZW5kZXIgfSk7XG4gICAgfVxuICB9LFxuICB7IGluY2x1ZGVGYWlsZWQ6IGZhbHNlIH1cbik7XG47aW1wb3J0KFwibm9kZTpwcm9jZXNzXCIpLnRoZW4oKHApID0+IHAuc3Rkb3V0LndyaXRlKFwiXCIpKTsiXSwKICAibWFwcGluZ3MiOiAiOytFQUFBLE9BQVMseUJBQUFBLEVBQXFDLGdCQUFBQyxNQUFvQixvQkFJbEUsSUFBTUMsRUFBZ0Isb0VBR2hCQyxFQUFlLHFFQUlyQixJQUFNQyxFQUFpQixDQUNyQixLQUFNLEVBQ04sS0FBTSxDQUNSLEVBR01DLEVBQTRCLENBRWhDLHFFQUVBLG9FQUNGLEVBS0EsU0FBU0MsRUFBY0MsRUFBcUNDLEVBQTBCLENBR3BGLE9BRlksT0FBT0QsR0FBYyxTQUFXLE9BQU9BLENBQVMsRUFDaEQsT0FBT0EsR0FBYyxTQUFXLFNBQVNBLEVBQVcsRUFBRSxFQUFJQSxHQUN6RCxLQUFLLElBQUksR0FBSUMsQ0FBUSxDQUNwQyxDQUpTQyxFQUFBSCxFQUFBLGlCQVNULFNBQVNJLEVBQWdCQyxFQUEwQixDQUNqRCxPQUFJTixFQUFnQixTQUFXLEVBQ3RCLEdBRUZBLEVBQWdCLEtBQ3BCTyxHQUFXQSxFQUFPLFlBQVksSUFBTUQsRUFBUSxZQUFZLENBQzNELENBQ0YsQ0FQU0YsRUFBQUMsRUFBQSxtQkFZVCxTQUFTRyxFQUFZQyxFQUF3QixDQUMzQyxPQUFPQSxFQUFNLFlBQVksSUFBTUMsRUFBYSxZQUFZLENBQzFELENBRlNOLEVBQUFJLEVBQUEsZUFPVCxTQUFTRyxFQUFZRixFQUF3QixDQUMzQyxPQUFPQSxFQUFNLFlBQVksRUFBRSxTQUFTLFlBQVksQ0FDbEQsQ0FGU0wsRUFBQU8sRUFBQSxlQW1CVEMsRUFBc0IsS0FBSyxDQUN6QixRQUFTQyxFQUNULFFBQVNDLEVBQWEsa0JBRXRCLGFBQWMsU0FDaEIsQ0FBQyxFQUFFLGNBQ0QsTUFBT0MsRUFBNkJDLElBQXNCLENBRXhELEdBQUtELEVBQUcsU0FLSEEsRUFBRyxPQUlSLFFBQVdFLEtBQVNGLEVBQUcsT0FBUSxDQUU3QixHQUFJLENBQUNFLEVBQU0sS0FBSyxTQUFTLEdBQUdKLENBQWEscUJBQXFCLEVBQzVELFNBR0YsSUFBTUssRUFBWUQsRUFBTSxLQUNsQkUsRUFBU0QsRUFBVSxPQUd6QixHQUFJLENBQUNiLEVBQWdCYyxDQUFNLEVBQ3pCLFNBSUYsSUFBTUMsRUFBYUYsRUFBVSxZQUN2QkcsRUFBY0gsRUFBVSxhQUk5QixHQUFJLEVBRmlCVixFQUFZWSxDQUFVLEdBQUtULEVBQVlVLENBQVcsR0FJckUsU0FJRixJQUFNQyxFQUFhckIsRUFBY2lCLEVBQVUsYUFBY25CLEVBQWUsSUFBSSxFQUN0RXdCLEVBQWF0QixFQUFjaUIsRUFBVSxjQUFlbkIsRUFBZSxJQUFJLEVBR3ZFeUIsRUFBZUYsRUFBYSxHQUFLQyxFQUFhLEVBQ2hERCxFQUFhQyxFQUNiLEVBR0pQLEVBQUksWUFBWSxLQUFLLFVBQVcsQ0FDOUIsV0FBWUQsRUFBRyxLQUNmLE9BQVFBLEVBQUcsS0FDWCxPQUFRSSxFQUNSLFVBQVcsT0FBT0QsRUFBVSxTQUFTLEVBQ3JDLFdBQUFJLEVBQ0EsV0FBQUMsRUFDQSxhQUFBQyxFQUNBLFdBQUFKLEVBQ0EsWUFBQUMsRUFDQSxRQUFTTixFQUFHLFNBQVMsU0FBUyxHQUFLLElBQ25DLFFBQVNBLEVBQUcsT0FDZCxDQUFDLEVBR0RDLEVBQUksTUFBTSxRQUFRLGVBQWUsRUFBRSxJQUFJLEVBQUcsQ0FBRSxPQUFRRyxDQUFPLENBQUMsRUFDNURILEVBQUksTUFBTSxRQUFRLG9CQUFvQixFQUFFLElBQUlNLEVBQVksQ0FBRSxPQUFRSCxDQUFPLENBQUMsRUFDMUVILEVBQUksTUFBTSxRQUFRLG9CQUFvQixFQUFFLElBQUlPLEVBQVksQ0FBRSxPQUFRSixDQUFPLENBQUMsRUFDMUVILEVBQUksTUFBTSxNQUFNLGVBQWUsRUFBRSxPQUFPUSxFQUFjLENBQUUsT0FBUUwsQ0FBTyxDQUFDLENBQzFFLENBQ0YsRUFDQSxDQUFFLGNBQWUsRUFBTSxDQUN6QixFQUNDLE9BQU8sY0FBYyxFQUFFLEtBQU1NLEdBQU1BLEVBQUUsT0FBTyxNQUFNLEVBQUUsQ0FBQyIsCiAgIm5hbWVzIjogWyJBcHRvc01vZHVsZXNQcm9jZXNzb3IiLCAiQXB0b3NOZXR3b3JrIiwgIk1PU0FJQ19ST1VURVIiLCAiVVNEQ19BRERSRVNTIiwgIlRPS0VOX0RFQ0lNQUxTIiwgIkJVWUJBQ0tfV0FMTEVUUyIsICJmcm9tUmF3QW1vdW50IiwgInJhd0Ftb3VudCIsICJkZWNpbWFscyIsICJfX25hbWUiLCAiaXNCdXliYWNrV2FsbGV0IiwgImFkZHJlc3MiLCAid2FsbGV0IiwgImlzVXNkY0Fzc2V0IiwgImFzc2V0IiwgIlVTRENfQUREUkVTUyIsICJpc01vdmVBc3NldCIsICJBcHRvc01vZHVsZXNQcm9jZXNzb3IiLCAiTU9TQUlDX1JPVVRFUiIsICJBcHRvc05ldHdvcmsiLCAidHgiLCAiY3R4IiwgImV2ZW50IiwgImV2ZW50RGF0YSIsICJzZW5kZXIiLCAiaW5wdXRBc3NldCIsICJvdXRwdXRBc3NldCIsICJ1c2RjQW1vdW50IiwgIm1vdmVBbW91bnQiLCAicHJpY2VQZXJNb3ZlIiwgInAiXQp9Cg==